<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link href="https://kit-pro.fontawesome.com/releases/v6.2.0/css/pro.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js" integrity="sha512-pumBsjNRGGqkPzKHndZMaAG+bir374sORyzM3uulLV14lN5LyykqNk8eEeUlUkB3U0M4FApyaHraT65ihJhDpQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: rgb(7, 5, 8);
        }

        #tabcon {
            background-color: rgb(6, 0, 10);
        }
        .btn_tab {
            border: 1px solid rgb(16, 6, 29);
            background-color: rgb(7, 0, 10);
            border-radius: 2px;
            color: white;
            min-width: 100px;
            text-align: start !important;
            transition: all 0.3s;
        }

        .btn_tabusing {
            border: 1px solid rgb(20, 11, 32);
            background-color: rgb(7, 5, 8);
            border-radius: 8px;
            color: white;
            width: 150px;
            text-align: start !important;
            transition: all 0.3s;
        }

        .btn_tabadd {
            border: none;
            background-color: black;
            color: white;
            font-size: 13px;
            text-align: center !important;
        }

        .btn_intab {
            border: none;
            background-color: transparent;
            color: white;
            font-family: "Kanit", sans-serif;
            font-weight: 300;
            font-size: 15px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: all 0.3s;
        }

        ::-webkit-scrollbar {
            width: 3px;
            height: 4px;
            background-color: black;
        }

        ::-webkit-scrollbar-thumb {
            background-color: white;
            max-height: 6px;
            border-radius: 10px;
        }

        .grid-tab {
            display: grid;
            grid-template-columns: auto 30px;
            gap: 10px;
        }
        .grid-tabcon {
            display: grid;
            grid-template-columns: auto 30px;
        }
        .bg-black {
            background-color: black;
        }
        .bg-modal {
            border-radius: 10px !important;
            border: 1px solid rgb(49, 49, 49) !important;
            background-color: rgb(12, 12, 12) !important;
            color: white !important;
        }
        .btnm {
            border-radius: 5px;
            border: 1px solid rgb(49, 49, 49);
            background-color: rgb(12, 12, 12);
            color: white;
            font-family: "Kanit", sans-serif;
            font-weight: 300;
            font-size: 15px;
        }
        .bg-glass {
            backdrop-filter: blur(1px);
        }
    </style>
</head>
<body>
    <div class="modal fade bg-glass" id="addtab" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content bg-modal">
                <div class="modal-body">
                    <center>
                        <div class="col-lg-10 m-cent">
                            <div class="mb-2 mt-2">
                                <div class="mb-2">
                                    <p class="mb-1 text-white">Tab Name</p>
                                    <input type="text" id="tabname" class="form-control bg-modal" value="">
                                </div>
                            </div>
                            <button type="button" class="btnm w-100 mt-2" onclick="addtab()" data-id="">Add Tab</button>
                        </div>
                    </center>
                </div>
            </div>
        </div>
    </div>
    <div class="grid-tabcon bg-black">
        <div id="tabcon" class="d-flex overflow-auto px-2">
            <!-- Tab buttons will be dynamically inserted here -->
        </div>
    </div>
    <div style="width: 100%; height: 10px; background-color: black;"></div>
    <div id="container" style="width:100%;height:100%;"></div>

    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="vs/loader.js"></script>

    <script>
        const pluginFilenames = [
            'pluginname.js',
            'pluginname.js',
            'pluginname.js',
            'pluginname.js',
            'pluginname.js',
            'pluginname.js',
        ];

        function loadAndExecutePlugins() {
            const pluginsFolder = './plugins/';
            pluginFilenames.forEach(filename => {
                const scriptElement = document.createElement('script');
                scriptElement.src = pluginsFolder + filename;
                document.body.appendChild(scriptElement);
            });

            const themeScript = document.createElement('script');
            themeScript.src = './themes/theme.js';
            document.body.appendChild(themeScript);
        }

        window.addEventListener('DOMContentLoaded', loadAndExecutePlugins);
    </script>

    <script>
        function showInjectionMessage() {
            Toastify({
                text: "BetterSolara injected",
                duration: 3000,
                newWindow: true,
                close: true,
                gravity: "top",
                position: "center",
                stopOnFocus: true,
                style: {
                    background: "blue",
                },
            }).showToast();

            setTimeout(function() {
                Toastify({
                    text: "Made by blitzedzz",
                    duration: 3000,
                    newWindow: true,
                    close: true,
                    gravity: "top",
                    position: "center",
                    stopOnFocus: true,
                    style: {
                        background: "blue",
                    },
                }).showToast();
            }, 3000);
        }

        showInjectionMessage();
    </script>

    <script>
        let tab_editing = "";
        let first_tab = "main.lua";

        async function start() {
            opentab(first_tab);
            changetabanim(first_tab);
        }

        async function loadtab(first, addtab) {
            try {
                document.getElementById("tabcon").innerHTML = "";
                const response = await fetch('http://localhost:9911/files');
                const files = await response.json();
                const tabcon = document.getElementById('tabcon');
                let lastcreate = "main.lua";

                files.forEach(file => {
                    if (file.name !== "undefined") {
                        const tabButton = document.createElement('div');
                        tabButton.classList.add('grid-tab', 'btn_tab', 'mb-2', 'px-1', 'mx-1');
                        if (first_tab === "") {
                            tabButton.innerHTML = `
                                <button class="text-start btn_intab" onclick="opentab('${file.name}')" data-file="${file.name}" id="first_tab">${file.name}</button>
                                <button class="btn_intab" onclick="deltab('${file.name}')"><i class="fa-solid fa-circle-xmark" style="margin-top: 5px !important;"></i></button>
                            `;
                            first_tab = file.name;
                        } else {
                            tabButton.innerHTML = `
                                <button class="text-start btn_intab" onclick="opentab('${file.name}')" data-file="${file.name}" id="first_tab">${file.name}</button>
                                <button class="btn_intab" onclick="deltab('${file.name}')"><i class="fa-solid fa-circle-xmark" style="margin-top: 5px !important;"></i></button>
                            `;
                        }
                        tabcon.appendChild(tabButton);
                        lastcreate = file.name;
                    }
                });

                if (addtab) {
                    const tabButton = document.createElement('div');
                    tabButton.classList.add('grid-tab', 'btn_tab', 'mb-2', 'px-1', 'mx-1');
                    tabButton.innerHTML = `
                        <button class="text-start btn_intab" onclick="opentab('${addtab}')" data-file="${addtab}">${addtab}</button>
                        <button class="btn_intab" onclick="deltab('${addtab}')"><i class="fa-solid fa-circle-xmark" style="margin-top: 5px !important;"></i></button>
                    `;
                    tabcon.appendChild(tabButton);
                    lastcreate = addtab;
                }

                const addTabButton = document.createElement('div');
                addTabButton.classList.add('grid-tab', 'btn_tabadd', 'mb-2', 'px-1', 'mx-1');
                addTabButton.setAttribute('data-bs-toggle', 'modal');
                addTabButton.setAttribute('data-bs-target', '#addtab');
                addTabButton.innerHTML = '<button class="btn_intab" style="text-align:center !important;"><i class="fa-solid fa-circle-plus" style="margin-top: 5px !important;"></i></button>';
                tabcon.appendChild(addTabButton);

                if (first) {
                    opentab(lastcreate);
                    changetabanim(lastcreate);
                }
            } catch (error) {
                console.error('Error loading tabs:', error);
            }
        }

        async function deltab(name) {
            try {
                const response = await fetch('http://localhost:9911/delete', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name })
                });

                if (response.ok) {
                    await loadtab(false);
                } else {
                    console.error('Error deleting tab:', response.statusText);
                }
            } catch (error) {
                console.error('Error deleting tab:', error);
            }
        }

        function changetabanim(tab) {
            tab_editing = tab;
            const tabs = document.querySelectorAll('.btn_tab, .btn_tabusing');
            tabs.forEach(tabElem => {
                const button = tabElem.querySelector('button[data-file]');
                if (button && button.getAttribute('data-file') === tab) {
                    tabElem.classList.add('btn_tabusing');
                    tabElem.classList.remove('btn_tab');
                } else {
                    tabElem.classList.add('btn_tab');
                    tabElem.classList.remove('btn_tabusing');
                }
            });
        }

        async function addtab() {
            const tabname = document.getElementById('tabname').value;
            try {
                const response = await fetch('http://localhost:9911/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name: tabname })
                });

                if (response.ok) {
                    await loadtab(false, tabname);
                } else {
                    console.error('Error adding tab:', response.statusText);
                }
            } catch (error) {
                console.error('Error adding tab:', error);
            }
        }

        async function opentab(tab) {
            try {
                changetabanim(tab);
                const response = await fetch('http://localhost:9911/files/' + tab);
                const fileContent = await response.text();
                const model = monaco.editor.getModels()[0];
                model.setValue(fileContent);
                const saveBtn = document.getElementById('save-button');
                if (saveBtn) {
                    saveBtn.setAttribute('data-file', tab);
                }
            } catch (error) {
                console.error('Error opening tab:', error);
            }
        }

        require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs' }});
        window.MonacoEnvironment = { getWorkerUrl: function() { return proxy; }};
        let proxy = URL.createObjectURL(new Blob([`
            self.MonacoEnvironment = {
                baseUrl: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/'
            };
            importScripts('https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs/base/worker/workerMain.js');
        `], { type: 'application/javascript' }));

        require(["vs/editor/editor.main"], function () {
            monaco.editor.create(document.getElementById('container'), {
                value: [
                    'function x() {',
                    '\tconsole.log("Hello world!");',
                    '}'
                ].join('\n'),
                language: 'javascript',
                theme: 'vs-dark'
            });
        });

        window.onload = async function() {
            await loadtab(true);
        };

        document.body.insertAdjacentHTML('beforeend', `
            <button id="save-button" class="btnm w-100 mt-2" style="position: fixed; bottom: 10px; right: 10px; z-index: 1000;" onclick="saveFile()">Save</button>
        `);

        async function saveFile() {
            const editor = monaco.editor.getModels()[0];
            const fileContent = editor.getValue();
            const tab = tab_editing;
            try {
                const response = await fetch('http://localhost:9911/save', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name: tab, content: fileContent })
                });

                if (response.ok) {
                    Toastify({
                        text: `Saved ${tab}`,
                        duration: 3000,
                        close: true,
                        gravity: "top",
                        position: "right",
                        stopOnFocus: true,
                        style: {
                            background: "green",
                        },
                    }).showToast();
                } else {
                    console.error('Error saving file:', response.statusText);
                }
            } catch (error) {
                console.error('Error saving file:', error);
            }
        }
    </script>
</body>
</html>
